<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.97.3" />
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Creating Your First Cluster | Omni</title>
<meta name="description" content="A guide for creating your first cluster with the Sidero management plane">
<meta property="og:title" content="Creating Your First Cluster" />
<meta property="og:description" content="A guide for creating your first cluster with the Sidero management plane" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/v0.1/guides/first-cluster/" /><meta property="article:section" content="v0.1" />



<meta itemprop="name" content="Creating Your First Cluster">
<meta itemprop="description" content="A guide for creating your first cluster with the Sidero management plane">

<meta itemprop="wordCount" content="825">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Creating Your First Cluster"/>
<meta name="twitter:description" content="A guide for creating your first cluster with the Sidero management plane"/>




<link rel="preload" href="/scss/main.min.0ef68169fe3e3f67b5cf6bc5f00f55fa4cd0402d35e7d812ee541930f94707e6.css" as="style">
<link href="/scss/main.min.0ef68169fe3e3f67b5cf6bc5f00f55fa4cd0402d35e7d812ee541930f94707e6.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>
<link rel="stylesheet" type="text/css" href="/asciinema/asciinema-player.css" />



    <link rel="stylesheet" href="/css/clipboard.css">




  
  
  
    
    
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-SFLNPVQLRL"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-SFLNPVQLRL', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 203.74 226.05"><defs><style>.cls-1{fill:url(#linear-gradient)}.cls-2{fill:url(#linear-gradient-2)}.cls-3{fill:url(#linear-gradient-3)}.cls-4{fill:url(#linear-gradient-4)}.cls-5{fill:url(#linear-gradient-5)}</style><linearGradient id="linear-gradient" x1="101.85" y1="-12.91" x2="101.85" y2="224.04" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ffd200"/><stop offset=".08" stop-color="#ffb500"/><stop offset=".2" stop-color="#ff8c00"/><stop offset=".3" stop-color="#ff7300"/><stop offset=".36" stop-color="#ff6a00"/><stop offset=".48" stop-color="#fc4f0e"/><stop offset=".65" stop-color="#f92f1e"/><stop offset=".79" stop-color="#f81b27"/><stop offset=".89" stop-color="#f7142b"/><stop offset="1" stop-color="#df162e"/></linearGradient><linearGradient id="linear-gradient-2" x1="24.84" y1="-12.91" x2="24.84" y2="224.04" xlink:href="#linear-gradient"/><linearGradient id="linear-gradient-3" x1="178.9" y1="-12.91" x2="178.9" y2="224.04" xlink:href="#linear-gradient"/><linearGradient id="linear-gradient-4" x1="145.06" y1="-12.91" x2="145.06" y2="224.04" xlink:href="#linear-gradient"/><linearGradient id="linear-gradient-5" x1="58.64" y1="-12.91" x2="58.64" y2="224.04" xlink:href="#linear-gradient"/></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-1" d="M101.89 226.05c2.85.0 5.67-.15 8.46-.35V.35c-2.8-.21-5.62-.35-8.48-.35s-5.7.14-8.52.35V225.69c2.81.21 5.64.35 8.5.36z"/><path class="cls-2" d="M11.56 50.9 9.12 48.47A112.82 112.82.0 00.2 63.61c29.42 29.89 32.52 44.31 32.48 49.14C32.57 125 17.58 144.21.0 162a113.69 113.69.0 008.84 15.15c1-1 1.95-1.92 2.92-2.9 25.37-25.54 37.77-45.61 37.92-61.38S37.36 77 11.56 50.9z"/><path class="cls-3" d="M192 174.29l2.92 2.9A113.69 113.69.0 00203.74 162c-17.57-17.83-32.56-37.09-32.68-49.29-.11-11.9 14.79-31.15 32.46-49.18a112.88 112.88.0 00-8.9-15.1l-2.44 2.43c-25.8 26.05-38.27 46.34-38.12 62s12.55 35.89 37.94 61.43z"/><path class="cls-4" d="M140.68 112.83c0-22 9.81-58.58 24.92-93.15A113 113 0 00150.45 11c-16.54 37.27-26.78 76.91-26.78 101.87.0 24.15 11.09 64.23 27.93 101.7a113 113 0 0014.84-8.77c-15.59-35.07-25.76-71.73-25.76-92.97z"/><path class="cls-5" d="M80 112.83C80 87.74 69.35 47.88 53 11.07a112.76 112.76.0 00-14.93 8.64C53.21 54.26 63 90.85 63 112.83c0 21.23-10.17 57.88-25.76 92.91a113.66 113.66.0 0014.84 8.77C68.94 177.05 80 137 80 112.83z"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Omni</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://talos.dev" target="_blank" ><span>Talos Linux</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/siderolabs" target="_blank" ><span>GitHub</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://www.siderolabs.com" target="_blank" ><span>Sidero Labs</span></a>
			</li>
			
			
			<li class="nav-item dropdown mr-4 d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/v0.6">v0.6 (pre-release)</a>
	
	<a class="dropdown-item" href="/v0.5">v0.5 (latest)</a>
	
	<a class="dropdown-item" href="/v0.4">v0.4</a>
	
	<a class="dropdown-item" href="/v0.3">v0.3</a>
	
	<a class="dropdown-item" href="/v0.2">v0.2</a>
	
	<a class="dropdown-item" href="/v0.1">v0.1</a>
	
</div>

			</li>
			
			
      <li id="algolia-search"></li>
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-v01-li">
  <a href="/v0.1/" title="Welcome" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-v01"><span class="">Documentation</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-v01overview-li">
  <a href="/v0.1/overview/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-v01overview"><span class="">Overview</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01overviewintroduction-li">
  <a href="/v0.1/overview/introduction/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01overviewintroduction"><span class="">Introduction</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01overviewinstallation-li">
  <a href="/v0.1/overview/installation/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01overviewinstallation"><span class="">Installation</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01overviewarchitecture-li">
  <a href="/v0.1/overview/architecture/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01overviewarchitecture"><span class="">Architecture</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01overviewresources-li">
  <a href="/v0.1/overview/resources/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01overviewresources"><span class="">Resources</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-v01resource-configuration-li">
  <a href="/v0.1/resource-configuration/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-v01resource-configuration"><span class="">Resource Configuration</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01resource-configurationenvironments-li">
  <a href="/v0.1/resource-configuration/environments/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01resource-configurationenvironments"><span class="">Environments</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01resource-configurationservers-li">
  <a href="/v0.1/resource-configuration/servers/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01resource-configurationservers"><span class="">Servers</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01resource-configurationserverclasses-li">
  <a href="/v0.1/resource-configuration/serverclasses/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01resource-configurationserverclasses"><span class="">Server Classes</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-v01resource-configurationmetadata-li">
  <a href="/v0.1/resource-configuration/metadata/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01resource-configurationmetadata"><span class="">Metadata</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-v01guides-li">
  <a href="/v0.1/guides/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-v01guides"><span class="">Guides</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-v01guidesbootstrapping-li">
  <a href="/v0.1/guides/bootstrapping/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01guidesbootstrapping"><span class="">Bootstrapping</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-v01guidesfirst-cluster-li">
  <a href="/v0.1/guides/first-cluster/" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-v01guidesfirst-cluster"><span class="td-sidebar-nav-active-item">Creating Your First Cluster</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-v01guidespatching-li">
  <a href="/v0.1/guides/patching/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01guidespatching"><span class="">Patching</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-v01guidesflow-li">
  <a href="/v0.1/guides/flow/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-v01guidesflow"><span class="">Provisioning Flow</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a id="print" href="/v0.1/guides/_print/"><i class="fa fa-print fa-fw"></i> Print entire section</a>

</div>

            


<div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#reconfigure-sidero">Reconfigure Sidero</a>
      <ul>
        <li><a href="#patch-services">Patch Services</a></li>
        <li><a href="#update-dhcp">Update DHCP</a></li>
      </ul>
    </li>
    <li><a href="#register-the-servers">Register the Servers</a></li>
    <li><a href="#accept-the-servers">Accept the Servers</a></li>
    <li><a href="#create-the-cluster">Create the Cluster</a></li>
  </ul>
</nav></div>



            

	
		
			
		
		



  
  

	
		
			
		
		



  
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            





  
  <div class="version-banner pageinfo pageinfo-warning">
    <p>Version v0.1 of the
      documentation is no longer actively maintained. The site that you are
      currently viewing is an archived snapshot.
      For up-to-date documentation, see the
        <a href="/v0.5">latest version</a>.</p>
      
    
  </div>

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/v0.1/">Documentation</a>
  </li>
  <li class="breadcrumb-item">
    <a href="/v0.1/guides/">Guides</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="/v0.1/guides/first-cluster/">Creating Your First Cluster</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Creating Your First Cluster</h1>
	<div class="lead">A guide for creating your first cluster with the Sidero management plane</div>
	<header class="article-meta">
		
		
			
				


			
				


			
		
		
	</header>    
	<h2 id="introduction">Introduction</h2>
<p>This guide will detail the steps needed to provision your first bare metal Talos cluster after completing the bootstrap and pivot steps detailed in the previous guide.
There will be two main steps in this guide: reconfiguring the Sidero components now that they have been pivoted and the actual cluster creation.</p>
<h2 id="reconfigure-sidero">Reconfigure Sidero</h2>
<h3 id="patch-services">Patch Services</h3>
<p>In this guide, we will convert the metadata service to a NodePort service and the other services to use host networking.
This is also necessary because some protocols like TFTP don&rsquo;t allow for port configuration.
Along with some nodeSelectors and a scale up of the metal controller manager deployment, creating the services this way allows for the creation of DNS names that point to all management plane nodes and provide an HA experience if desired.
It should also be noted, however, that there are many options for acheiving this functionality.
Users can look into projects like MetalLB or KubeRouter with BGP and ECMP if they desire something else.</p>
<p>Metal Controller Manager:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#586e75">## Use host networking</span>
</span></span><span style="display:flex;"><span>kubectl patch deploy -n sidero-system sidero-controller-manager --type<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;json&#39;</span> -p<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;[{&#34;op&#34;: &#34;add&#34;, &#34;path&#34;: &#34;/spec/template/spec/hostNetwork&#34;, &#34;value&#34;: true}]&#39;</span>
</span></span></code></pre></div><p>Metadata Server:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#586e75">## Convert metadata server service to nodeport</span>
</span></span><span style="display:flex;"><span>kubectl patch service -n sidero-system sidero-metadata-server --type<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;json&#39;</span> -p<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/type&#34;, &#34;value&#34;: &#34;NodePort&#34;}]&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75">## Set a known nodeport for metadata server</span>
</span></span><span style="display:flex;"><span>kubectl patch service -n sidero-system sidero-metadata-server --type<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;json&#39;</span> -p<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/ports&#34;, &#34;value&#34;: [{&#34;port&#34;: 80, &#34;protocol&#34;: &#34;TCP&#34;, &#34;targetPort&#34;: &#34;http&#34;, &#34;nodePort&#34;: 30005}]}]&#39;</span>
</span></span></code></pre></div><h4 id="update-environment">Update Environment</h4>
<p>The metadata server&rsquo;s information needs to be updated in the default environment.
Edit the environment with <code>kubectl edit environment default</code> and update the <code>talos.config</code> kernel arg with the IP of one of the management plane nodes (or the DNS entry you created) and the nodeport we specified above (30005).</p>
<h3 id="update-dhcp">Update DHCP</h3>
<p>The DHCP options configured in the previous guide should now be updated to point to your new management plane IP or to the DNS name if it was created.</p>
<p>A revised ipxe-metal.conf file looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>allow bootp;
</span></span><span style="display:flex;"><span>allow booting;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>next-server 192.168.254.2;
</span></span><span style="display:flex;"><span><span style="color:#719e07">if</span> exists user-class and option user-class <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;iPXE&#34;</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>  filename <span style="color:#2aa198">&#34;http://192.168.254.2:8081/boot.ipxe&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span> <span style="color:#719e07">else</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">if</span> substring <span style="color:#719e07">(</span>option vendor-class-identifier, 15, 5<span style="color:#719e07">)</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;00000&#34;</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75"># BIOS</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">if</span> substring <span style="color:#719e07">(</span>option vendor-class-identifier, 0, 10<span style="color:#719e07">)</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;HTTPClient&#34;</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>      option vendor-class-identifier <span style="color:#2aa198">&#34;HTTPClient&#34;</span>;
</span></span><span style="display:flex;"><span>      filename <span style="color:#2aa198">&#34;http://192.168.254.2:8081/tftp/undionly.kpxe&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span> <span style="color:#719e07">else</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>      filename <span style="color:#2aa198">&#34;undionly.kpxe&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">}</span> <span style="color:#719e07">else</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75"># UEFI</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">if</span> substring <span style="color:#719e07">(</span>option vendor-class-identifier, 0, 10<span style="color:#719e07">)</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;HTTPClient&#34;</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>      option vendor-class-identifier <span style="color:#2aa198">&#34;HTTPClient&#34;</span>;
</span></span><span style="display:flex;"><span>      filename <span style="color:#2aa198">&#34;http://192.168.254.2:8081/tftp/ipxe.efi&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span> <span style="color:#719e07">else</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>      filename <span style="color:#2aa198">&#34;ipxe.efi&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>host talos-mgmt-0 <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>   fixed-address 192.168.254.2;
</span></span><span style="display:flex;"><span>   hardware ethernet d0:50:99:d3:33:60;
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></div><h2 id="register-the-servers">Register the Servers</h2>
<p>At this point, any servers on the same network as Sidero should PXE boot using the Sidero PXE service.
To register a server with Sidero, simply turn it on and Sidero will do the rest.
Once the registration is complete, you should see the servers registered with <code>kubectl get servers</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl get servers -o wide
</span></span><span style="display:flex;"><span>NAME                                   HOSTNAME        ACCEPTED   ALLOCATED   CLEAN
</span></span><span style="display:flex;"><span>00000000-0000-0000-0000-d05099d33360   192.168.254.2   <span style="color:#b58900">false</span>      <span style="color:#b58900">false</span>       <span style="color:#b58900">false</span>
</span></span></code></pre></div><h2 id="accept-the-servers">Accept the Servers</h2>
<p>Note in the output above that the newly registered servers are not <code>accepted</code>.
In order for a server to be eligible for consideration, it <em>must</em> be marked as <code>accepted</code>.
Before a <code>Server</code> is accepted, no write action will be performed against it.
Servers can be accepted by issuing a patch command like:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl patch server 00000000-0000-0000-0000-d05099d33360 --type<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;json&#39;</span> -p<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/accepted&#34;, &#34;value&#34;: true}]&#39;</span>
</span></span></code></pre></div><p>For more information on server acceptance, see the <a href="/docs/v0.1/configuration/servers">server docs</a>.</p>
<h2 id="create-the-cluster">Create the Cluster</h2>
<p>The cluster creation process should be identical to what was detailed in the previous guide.
Note that, for this example, the same &ldquo;default&rdquo; serverclass that we used in the previous guide is used again.
Using clusterctl, we can create a cluster manifest with:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clusterctl config cluster workload-cluster -i sidero &gt; workload-cluster.yaml
</span></span></code></pre></div><p>Note that there are several variables that should be set in order for the templating to work properly:</p>
<ul>
<li><code>CONTROL_PLANE_ENDPOINT</code>: The endpoint used for the Kubernetes API server (e.g. <code>https://1.2.3.4:6443</code>).
This is the equivalent of the <code>endpoint</code> you would specify in <code>talosctl gen config</code>.
There are a variety of ways to configure a control plane endpoint.
Some common ways for an HA setup are to use DNS, a load balancer, or BGP.
A simpler method is to use the IP of a single node.
This has the disadvantage of being a single point of failure, but it can be a simple way to get running.</li>
<li><code>CONTROL_PLANE_SERVERCLASS</code>: The server class to use for control plane nodes.</li>
<li><code>WORKER_SERVERCLASS</code>: The server class to use for worker nodes.</li>
<li><code>KUBERNETES_VERSION</code>: The version of Kubernetes to deploy (e.g. <code>v1.19.4</code>).</li>
</ul>
<p>Now that we have the manifest, we can simply apply it:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f workload-cluster.yaml
</span></span></code></pre></div><p><strong>NOTE: The templated manifest above is meant to act as a starting point.</strong>
<strong>If customizations are needed to ensure proper setup of your Talos cluster, they should be added before applying.</strong></p>
<p>Once the workload cluster is setup, you can fetch the talosconfig with a command like:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get talosconfig -o yaml workload-cluster-cp-xxx -o <span style="color:#268bd2">jsonpath</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#39;{.status.talosConfig}&#39;</span> &gt; workload-cluster-talosconfig.yaml
</span></span></code></pre></div><p>Then the workload cluster&rsquo;s kubeconfig can be fetched with <code>talosctl --talosconfig workload-cluster-talosconfig.yaml kubeconfig /desired/path</code>.</p>

	
	
	
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/SideroLabs" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/siderolabs" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Sidero Labs, Inc. All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>


















<script src="/js/main.min.68e31ec429bf4c76d0cfc803a06912682cfe4274c4cafeb4d70d00cfe3c3b618.js" integrity="sha256-aOMexCm/THbQz8gDoGkSaCz&#43;QnTEyv601w0Az&#43;PDthg=" crossorigin="anonymous"></script>




    <script src="/js/clipboard.js"></script>





<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>



<script>
  docsearch({
    appId: "0UBMNL8U2A",
    apiKey: "b23cc1d9c0b406b2d1b83f0c652ead8a",
    indexName: "sidero",
    container: '#algolia-search',
    debug: true,
    searchParameters: {
      facetFilters: ['version:v0.1'],
    },
  });
</script>






<meta name="docsearch:version" content="v0.1" />




  </body>
</html>